<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <link rel="icon" href="../../favicon.svg"/>
    <link rel="stylesheet" href="../../fonts/Inter/inter.css"/>
    <link rel="stylesheet" href="../../fonts/JetBrainsMono/jetbrainsmono.css"/>
    <link rel="stylesheet" href="../../variables.css"/>
    <link rel="stylesheet" href="../../global.css"/>
    <link rel="stylesheet" href="../../katex.css"/>

    <link rel="stylesheet" media="print" href="../../print.css">

    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    
		<link href="../../_app/immutable/assets/Link.Cb7NHG_N.css" rel="stylesheet">
		<link href="../../_app/immutable/assets/0._avqqY0J.css" rel="stylesheet">
		<link href="../../_app/immutable/assets/2.DXAScjb8.css" rel="stylesheet">
		<link href="../../_app/immutable/assets/Title.DPHn_YVg.css" rel="stylesheet">
		<link href="../../_app/immutable/assets/Par.K_845M5t.css" rel="stylesheet">
		<link href="../../_app/immutable/assets/P.B2DWHBcA.css" rel="stylesheet">
		<link href="../../_app/immutable/assets/Math.BETNsMrj.css" rel="stylesheet">
		<link href="../../_app/immutable/assets/InternalCode.18_KRbfN.css" rel="stylesheet">
		<link href="../../_app/immutable/assets/Codeblock.CTVfIT4f.css" rel="stylesheet">
		<link href="../../_app/immutable/assets/Heading.B4n5dO8q.css" rel="stylesheet">
		<link href="../../_app/immutable/assets/Subheading.PZ7MELIW.css" rel="stylesheet">
		<link href="../../_app/immutable/assets/Code.DJ30TqtG.css" rel="stylesheet">
		<link href="../../_app/immutable/assets/ListItem.BKpMqDLa.css" rel="stylesheet">
		<link href="../../_app/immutable/assets/Image.4MnJTrhn.css" rel="stylesheet">
		<link href="../../_app/immutable/assets/Proof.BeOUDyan.css" rel="stylesheet">
		<link href="../../_app/immutable/assets/BulletList.DQWRVM89.css" rel="stylesheet">
		<link href="../../_app/immutable/assets/Icon.D0g2C4hd.css" rel="stylesheet">
		<link href="../../_app/immutable/assets/Block.DihCq8ef.css" rel="stylesheet">
		<link href="../../_app/immutable/assets/EnumList.CtnWplwG.css" rel="stylesheet">
		<link rel="modulepreload" href="../../_app/immutable/entry/start.BJRRbOI6.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/C4PYaXYV.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/D05M-i-Q.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/B1HoO4k0.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/DIeogL5L.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/D2mTW_Ts.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/zmIfRZ_X.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/DB1w4rN-.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/DDIRtGou.js">
		<link rel="modulepreload" href="../../_app/immutable/entry/app.BVG58rn_.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/CWj6FrbW.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/52QGYHnB.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/6jNYTp5s.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/C66zIgpa.js">
		<link rel="modulepreload" href="../../_app/immutable/nodes/0.BdmhUO9D.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/DGFEnqK6.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/BsetDOSZ.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/DQVJezX5.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/C_bKaSJV.js">
		<link rel="modulepreload" href="../../_app/immutable/nodes/2.7yTcSGO6.js">
		<link rel="modulepreload" href="../../_app/immutable/nodes/97.C3vKCux7.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/69_IOA4Y.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/CcX1cm_-.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/ClksMsit.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/B8FEnsbH.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/e5qaD0UW.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/BsuxlmZu.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/CYtJBVty.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/DunPP-_K.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/BPEYcd7-.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/i9XClpbl.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/VyKLllFE.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/D2QCM4hc.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/0Rd6UPhr.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/_RU5sT8R.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/Cdazp-58.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/BOV-mclC.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/Dv4xhkGP.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/CYEUtE_3.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/Cvd_SkJN.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/BRxLqHaC.js"><!--[--><!--]--><!--[--><!--]--><title>Красно-чёрное дерево</title>
</head>
<body data-sveltekit-preload-data="hover">
<div style="display: contents"><!--[--><!--[--><!----><header class="svelte-10uf3cq"><img src="/favicon.svg" alt="" role="presentation" class="svelte-10uf3cq"/> <nav class="svelte-10uf3cq"><a href="/scenario" class="svelte-1txvory colorless"><!---->Сценарий<!----></a><!----></nav></header><!----> <main><!--[--><!----><article class="svelte-1cvbhgs"><!----><div class="title svelte-uw1xhm"><!--[!--><h1 class="svelte-uw1xhm">Красно-чёрное дерево</h1><!--]--></div><!----> <div class="par svelte-q2zea3"><p class="svelte-cr0fdf"><!---->Балансировка на основе высоты требует дополнительных вычислений и проверок на каждую модифицирующую операцию.<!----></p><!----></div><!----> <div class="par svelte-q2zea3"><p class="svelte-cr0fdf"><!---->Давайте покрасим все вершины бинарного дерева поиска в красный или чёрный цвета.
    Будем считать, что у каждого реального листа есть по <!--[!--><span class="math"><!----><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span><!----></span><!--]--><!----> фиктивных ребёнка,
    которые будем называть фиктивными листами.<!----></p><!----> <p class="svelte-cr0fdf"><!---->Потребуем, чтобы для каждого узла все пути от него до фиктивных листьев содержат одинаковое количество чёрных узлов.
    Это свойство как раз обеспечит нам балансировку, но при условии, что чёрные узлы будут в дереве присутствовать.
    Покрасим корень в чёрный цвет, все фиктивные листы в чёрный цвет
    и потребуем, чтобы у каждого красного узла все дети были чёрными.<!----></p><!----><!----></div><!----> <div class="par svelte-q2zea3"><p class="svelte-cr0fdf"><!---->Итак, красно-чёрное дерево — бинарное дерево поиска, у которого<!----></p><!----></div><!----> <ul class="svelte-119ikxp wide"><li class="svelte-fa1o"><p class="svelte-cr0fdf"><!---->все реальные листы имеют фиктивных детей, называемых фиктивными листами<!----></p><!----></li><!----> <li class="svelte-fa1o"><p class="svelte-cr0fdf"><!---->все узлы покрашены в красный или чёрный цвета<!----></p><!----></li><!----> <li class="svelte-fa1o"><p class="svelte-cr0fdf"><!---->корень и все фиктивные листы чёрного цвета<!----></p><!----></li><!----> <li class="svelte-fa1o"><p class="svelte-cr0fdf"><!---->у каждого красного узла оба ребёнка чёрные<!----></p><!----></li><!----><!----></ul><!----> <figure class="svelte-1uuxmnb"><div class="wrapper"><img src="" alt="Пример красно-чёрного дерево" loading="lazy" class="svelte-1uuxmnb"/></div> <!--[!--><!--]--></figure><!----> <div class="par svelte-q2zea3"><p class="svelte-cr0fdf"><b>Чёрная высота</b> узла <!--[!--><span class="math"><!----><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span><!----></span><!--]--><!----> —
    количество чёрных узлов на пути от узла <!--[!--><span class="math"><!----><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span><!----></span><!--]--><!----> до фиктивного листа (любого).
    При этом сам узел <!--[!--><span class="math"><!----><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span><!----></span><!--]--><!----> мы не считаем.<!----></p><!----> <!--[--><div class="math-display svelte-1eg57kq"><!----><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi mathvariant="normal">bh</mi><mo>⁡</mo><mi>x</mi><mtext>  </mtext><mtext> ⁣</mtext><mo><mover><mo><mo>=</mo></mo><mstyle mathsize="0.5em"><mrow><mi mathvariant="normal">d</mi><mi mathvariant="normal">e</mi><mi mathvariant="normal">f</mi></mrow></mstyle></mover></mo><mtext>  </mtext><mtext> ⁣</mtext><mtext>количество чёрных узлов на пути от </mtext><mi>x</mi><mtext> до фиктивного листа</mtext></mrow><annotation encoding="application/x-tex">\bh x \defeq \text{количество чёрных узлов на пути от}~ x ~\text{до фиктивного листа}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0141em;"></span><span class="mop"><span class="mord mathrm">bh</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel"><span class="mop op-limits"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:1.0141em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop">=</span></span></span><span style="top:-3.5669em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord sizing reset-size3 size1"><span class="mord"><span class="mord mathrm" style="margin-right:0.07778em;">def</span></span></span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mspace" style="margin-right:-0.1667em;"></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord text"><span class="mord cyrillic_fallback">количество</span><span class="mord"> </span><span class="mord cyrillic_fallback">чёрных</span><span class="mord"> </span><span class="mord cyrillic_fallback">узлов</span><span class="mord"> </span><span class="mord cyrillic_fallback">на</span><span class="mord"> </span><span class="mord cyrillic_fallback">пути</span><span class="mord"> </span><span class="mord cyrillic_fallback">от</span></span><span class="mspace nobreak"> </span><span class="mord mathnormal">x</span><span class="mspace nobreak"> </span><span class="mord text"><span class="mord cyrillic_fallback">до</span><span class="mord"> </span><span class="mord cyrillic_fallback">фиктивного</span><span class="mord"> </span><span class="mord cyrillic_fallback">листа</span></span></span></span></span></span><!----></div><!--]--><!----> <p class="svelte-cr0fdf"><!---->Чёрной высотой дерева называется чёрная высота его корня.<!----></p><!----><!----></div><!----> <div class="block svelte-8d3fzq theorem"><h3 class="svelte-8d3fzq"><svg viewBox="0 0 48 48" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="svelte-1tf3wrl" style="height: 1.25rem; margin: 0rem;"><path d="M15.436 34H32.565C33.005 33.467 33.541 32.905 34.117 32.305C36.6 29.72 40 26.179 40 20C40 11.178 32.822 4 24 4C15.178 4 8 11.178 8 20C8 26.179 11.4 29.72 13.883 32.305C14.46 32.905 14.996 33.467 15.436 34ZM16.733 37C17.146 38.894 17.513 40.476 17.513 40.476C17.974 42.551 19.781 44 21.906 44H26.094C28.219 44 30.025 42.551 30.483 40.491C30.483 40.491 30.853 38.902 31.267 37H16.733Z"></path><!----></svg><!----> <!--[!-->Лемма о чёрной высоте<!--]--></h3> <p class="svelte-cr0fdf"><!---->Красно-чёрное дерево с <!--[!--><span class="math"><!----><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span><!----></span><!--]--><!----> внутренними узлами
    имеет высоту не более <!--[!--><span class="math"><!----><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mo stretchy="false">⌊</mo><msub><mrow><mi>log</mi><mo>⁡</mo></mrow><mn>2</mn></msub><mi>n</mi><mo stretchy="false">⌋</mo><mo>+</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">2 \lfloor \log_2 n \rfloor + 2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mopen">⌊</span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.207em;"><span style="top:-2.4559em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2441em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mclose">⌋</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span><!----></span><!--]--><!----><!----></p><!----></div><!----> <div class="proof svelte-17zasab"><p class="svelte-cr0fdf"><!---->Поддерево любого узла <!--[!--><span class="math"><!----><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span><!----></span><!--]--><!----> содержит как минимум <!--[!--><span class="math"><!----><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mrow><mi mathvariant="normal">bh</mi><mo>⁡</mo><mi>x</mi></mrow></msup><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">2^{\bh x} - 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9324em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop mtight"><span class="mord mathrm mtight">bh</span></span><span class="mspace mtight" style="margin-right:0.1952em;"></span><span class="mord mathnormal mtight">x</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span><!----></span><!--]--><!----> внутренних узлов.
    Это утверждение доказывается индукцией по высоте узла <!--[!--><span class="math"><!----><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span><!----></span><!--]--><!---->.<!----></p><!----> <p class="svelte-cr0fdf"><!---->Обозначим высоту дерева за <!--[!--><span class="math"><!----><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi></mrow><annotation encoding="application/x-tex">h</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">h</span></span></span></span><!----></span><!--]--><!---->.
    Тогда, согласно требованию для красных узлов, по крайней мере половина узлов на пути
    от корня к листу, не считая сам корень, должны быть чёрными.
    Значит, чёрная высота дерева должна быть минимум <!--[!--><span class="math"><!----><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mi mathvariant="normal">/</mi><mn>2</mn></mrow><annotation encoding="application/x-tex">h/2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">h</span><span class="mord">/2</span></span></span></span><!----></span><!--]--><!---->.
    Тогда<!----></p><!----> <!--[--><div class="math-display svelte-1eg57kq"><!----><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>n</mi><mo>⩾</mo><msup><mn>2</mn><mrow><mi>h</mi><mi mathvariant="normal">/</mi><mn>2</mn></mrow></msup><mo>−</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">n \ge 2^{h/2} - 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7733em;vertical-align:-0.1367em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel amsrm">⩾</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0213em;vertical-align:-0.0833em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">h</span><span class="mord mtight">/2</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span></span><!----></div><!--]--><!----> <p class="svelte-cr0fdf"><!---->Отсюда получаем, что<!----></p><!----> <!--[--><div class="math-display svelte-1eg57kq"><!----><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>h</mi><mo>⩽</mo><mn>2</mn><mo stretchy="false">⌊</mo><msub><mrow><mi>log</mi><mo>⁡</mo></mrow><mn>2</mn></msub><mi>n</mi><mo stretchy="false">⌋</mo><mo>+</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">h \le 2 \lfloor \log_2 n \rfloor + 2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8311em;vertical-align:-0.1367em;"></span><span class="mord mathnormal">h</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel amsrm">⩽</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">2</span><span class="mopen">⌊</span><span class="mop"><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.207em;"><span style="top:-2.4559em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2441em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">n</span><span class="mclose">⌋</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span></span><!----></div><!--]--><!----><!----></div><!----> <h1 class="svelte-1dact7k"><!---->Хранение красно-чёрного дерева<!----></h1><!----> <div class="par svelte-q2zea3"><p class="svelte-cr0fdf"><!---->Красно-чёрное дерево будет реализовано нами на указателях.
    При этом в каждом узле помимо ссылок на левого и правого ребёнка будем хранить ссылку на родителя.
    Это нужно для реализации поворотов без использования стека.<!----></p><!----></div><!----> <div class="codeblock svelte-in28rj"><div class="overflow-box svelte-in28rj"><code class="language-pseudocode svelte-127l4oe"><!---->Color <span class="operator">=</span> <span class="string">&apos;red&apos;</span> <span class="operator">|</span> <span class="string">&apos;black&apos;</span>

<span class="keyword">struct</span> <span class="class-name">node</span><span class="punctuation">:</span>
    <span class="abstract-type">literal</span><span class="punctuation">[</span>Color<span class="punctuation">]</span> color
    <span class="class-name">node</span><span class="operator">*</span> left
    <span class="class-name">node</span><span class="operator">*</span> right
    <span class="class-name">node</span><span class="operator">*</span> parent

    <span class="builtin">object</span> <span class="builtin">key</span><!----></code><!----></div></div><!----> <div class="par svelte-q2zea3"><p class="svelte-cr0fdf"><!---->При этом фиктивный лист имеет такую же структуру, имеет чёрный цвет, не имеет детей, и,
    очевидно, не несёт никакой полезной информации.
    Мы не будем явно задавать структуру этого фиктивного листа,
    а просто скажем, что фиктивными листами являются <span class="code svelte-1kfz46x"><code class="language-pseudocode svelte-127l4oe"><!----><span class="boolean">none</span><!----></code><!----></span><!----><!----></p><!----></div><!----> <h1 class="svelte-mdj34r"><!---->Повороты красно-чёрного дерева<!----></h1><!----> <div class="par svelte-q2zea3"><p class="svelte-cr0fdf"><!---->После модифицирующих операций нужно восстановить все свойства красно-чёрного дерева.
    Делается это обычно двумя разными операциями: поворотами и перекрашиваниями.
    Перекрашивания зависят от выполняемой операции, а вот повороты универсальны, поэтому их разберем отдельно.
    За изменения структуры красно-чёрного дерева отвечают только повороты.<!----></p><!----> <p class="svelte-cr0fdf"><!---->Повороты здесь схожи с поворотами AVL деревьев.<!----></p><!----><!----></div><!----> <div class="codeblock svelte-in28rj"><div class="overflow-box svelte-in28rj"><code class="language-pseudocode svelte-127l4oe"><!----><span class="keyword">function</span> <span class="function">left_rotate</span><span class="punctuation">(</span><span class="class-name">node</span> x<span class="punctuation">)</span><span class="punctuation">:</span>
    <span class="class-name">node</span> pivot <span class="operator">=</span> x<span class="punctuation">.</span>right  <span class="comment"># устанавливаем pivot</span>

    <span class="comment"># перенос родителя x в pivot</span>
    pivot<span class="punctuation">.</span>parent <span class="operator">=</span> x<span class="punctuation">.</span>parent
    <span class="keyword">if</span> x<span class="punctuation">.</span>parent <span class="keyword">is</span> <span class="keyword">not</span> <span class="boolean">none</span><span class="punctuation">:</span>
        <span class="keyword">if</span> x<span class="punctuation">.</span>parent<span class="punctuation">.</span>left <span class="operator">==</span> x<span class="punctuation">:</span>
            x<span class="punctuation">.</span>parent<span class="punctuation">.</span>left <span class="operator">=</span> pivot
        <span class="keyword">else</span><span class="punctuation">:</span>
            x<span class="punctuation">.</span>parent<span class="punctuation">.</span>right <span class="operator">=</span> pivot

    <span class="comment"># левое поддерево pivot становится правым поддеревом x</span>
    x<span class="punctuation">.</span>right <span class="operator">=</span> pivot<span class="punctuation">.</span>left
    <span class="keyword">if</span> pivot<span class="punctuation">.</span>left <span class="keyword">is</span> <span class="keyword">not</span> <span class="boolean">none</span><span class="punctuation">:</span>
        pivot<span class="punctuation">.</span>left<span class="punctuation">.</span>parent <span class="operator">=</span> x

    <span class="comment"># x становится левым дочерним узлом pivot</span>
    pivot<span class="punctuation">.</span>left <span class="operator">=</span> x
    x<span class="punctuation">.</span>parent <span class="operator">=</span> pivot<!----></code><!----></div></div><!----> <div class="codeblock svelte-in28rj"><div class="overflow-box svelte-in28rj"><code class="language-pseudocode svelte-127l4oe"><!----><span class="keyword">function</span> <span class="function">right_rotate</span><span class="punctuation">(</span><span class="class-name">node</span> x<span class="punctuation">)</span><span class="punctuation">:</span>
    <span class="class-name">node</span> pivot <span class="operator">=</span> x<span class="punctuation">.</span>left  <span class="comment"># устанавливаем pivot</span>

    <span class="comment"># перенос родителя x в pivot</span>
    pivot<span class="punctuation">.</span>parent <span class="operator">=</span> x<span class="punctuation">.</span>parent
    <span class="keyword">if</span> x<span class="punctuation">.</span>parent <span class="keyword">is</span> <span class="keyword">not</span> <span class="boolean">none</span><span class="punctuation">:</span>
        <span class="keyword">if</span> x<span class="punctuation">.</span>parent<span class="punctuation">.</span>left <span class="operator">==</span> x<span class="punctuation">:</span>
            x<span class="punctuation">.</span>parent<span class="punctuation">.</span>left <span class="operator">=</span> pivot
        <span class="keyword">else</span><span class="punctuation">:</span>
            x<span class="punctuation">.</span>parent<span class="punctuation">.</span>right <span class="operator">=</span> pivot

    <span class="comment"># правое поддерево pivot становится левым поддеревом x</span>
    x<span class="punctuation">.</span>left <span class="operator">=</span> pivot<span class="punctuation">.</span>right
    <span class="keyword">if</span> pivot<span class="punctuation">.</span>right <span class="keyword">is</span> <span class="keyword">not</span> <span class="boolean">none</span><span class="punctuation">:</span>
        pivot<span class="punctuation">.</span>right<span class="punctuation">.</span>parent <span class="operator">=</span> x

    <span class="comment"># x становится правым дочерним узлом pivot</span>
    pivot<span class="punctuation">.</span>right <span class="operator">=</span> x
    x<span class="punctuation">.</span>parent <span class="operator">=</span> pivot<!----></code><!----></div></div><!----> <h1 class="svelte-1dact7k"><!---->Вставка<!----></h1><!----> <div class="par svelte-q2zea3"><p class="svelte-cr0fdf"><!---->Выполняя вставку в красно-чёрное дерево, мы просто выполним обычную вставку как в бинарное дерево поиска.
    После нам нужно будет восстановить свойства красно-чёрного дерева, вращая рёбра и перекрашивая узлы.<!----></p><!----> <p class="svelte-cr0fdf"><!---->При вставке нового узла он встаёт на место одного из фиктивных листьев.
    Поэтому мы окрасим его в красный цвет и прикрепим к нему два фиктивных листа.
    Дальше действия зависят от цветов родственных узлов.<!----></p><!----> <p class="svelte-cr0fdf"><!---->Если родитель ребёнка черный, то никакие свойства деревьев не нарушены, и процедура завершается.
    Если же он красный, то нарушается свойство красных узлов, и нам нужно перекрашивать вершины.
    Наши действия зависят от цвета дяди вставленного узла.<!----></p><!----><!----></div><!----> <div class="par svelte-q2zea3"><p class="svelte-cr0fdf"><!---->Если дядя вставленного узла красный, то мы просто перекрашиваем родителя и дядю в чёрный, а деда в красный.
    Получается, что на всех путях от деда одинаковое количество чёрных вершин и у всех красных вершин все дети чёрные.<!----></p><!----></div><!----> <figure class="svelte-1uuxmnb"><div class="wrapper"><img src="" alt="Перекрашивание дерева, когда дядя вставляемого узла красный" loading="lazy" class="svelte-1uuxmnb"/></div> <!--[!--><!--]--></figure><!----> <div class="par svelte-q2zea3"><p class="svelte-cr0fdf"><!---->Если дядя вставленного узла чёрный (включая ситуацию, когда дяди нет, то есть когда дядя является фиктивным листом),
    то одного перекрашивания недостаточно.
    Если вставляемый узел находится с родителем в разной ориентации
    (например, родитель левый ребёнок деда, а вставляемый узел правый ребёнок родителя),
    то выполняем поворот вокруг родителя, выравнивая линию от деда до вставляемого узла.
    Затем родитель становится чёрным, дед становится красным, и выполняется финальный поворот вокруг деда.<!----></p><!----></div><!----> <figure class="svelte-1uuxmnb"><div class="wrapper"><img src="" alt="Перекрашивание дерева, когда дядя вставляемого узла чёрный" loading="lazy" class="svelte-1uuxmnb"/></div> <!--[!--><!--]--></figure><!----> <div class="par svelte-q2zea3"><p class="svelte-cr0fdf"><!---->Всю эту процедуру можно запихнуть в отдельную функцию <span class="code svelte-1kfz46x"><code class="language-pseudocode svelte-127l4oe"><!----><span class="function">fix_insert</span><span class="punctuation">(</span><span class="class-name">node</span> x<span class="punctuation">)</span><!----></code><!----></span><!---->,
    для того чтобы не захламлять основной код вставки.<!----></p><!----></div><!----> <div class="codeblock svelte-in28rj"><div class="overflow-box svelte-in28rj"><code class="language-pseudocode svelte-127l4oe"><!----><span class="keyword">function</span> <span class="function">fix_insertion</span><span class="punctuation">(</span><span class="class-name">node</span> x<span class="punctuation">)</span><span class="punctuation">:</span>
    <span class="keyword">if</span> x<span class="punctuation">.</span>parent <span class="keyword">is</span> <span class="boolean">none</span><span class="punctuation">:</span>  <span class="comment"># если x является корнем, то просто красим его в чёрный</span>
        x<span class="punctuation">.</span>color <span class="operator">=</span> <span class="string">&apos;black&apos;</span>
        <span class="keyword">return</span>

    <span class="keyword">while</span> x<span class="punctuation">.</span>parent<span class="punctuation">.</span>color <span class="keyword">is</span> <span class="string">&apos;red&apos;</span><span class="punctuation">:</span>
        grandfather <span class="operator">=</span> x<span class="punctuation">.</span>parent<span class="punctuation">.</span>parent

        <span class="comment"># родитель - левый ребенок деда</span>
        <span class="keyword">if</span> x<span class="punctuation">.</span>parent <span class="operator">==</span> grandfather<span class="punctuation">.</span>left<span class="punctuation">:</span>
            uncle <span class="operator">=</span> grandfather<span class="punctuation">.</span>right
            <span class="keyword">if</span> uncle<span class="punctuation">.</span>color <span class="keyword">is</span> <span class="string">&apos;red&apos;</span><span class="punctuation">:</span>
                x<span class="punctuation">.</span>parent<span class="punctuation">.</span>color <span class="operator">=</span> <span class="string">&apos;black&apos;</span>
                uncle<span class="punctuation">.</span>color <span class="operator">=</span> <span class="string">&apos;black&apos;</span>
                grandfather<span class="punctuation">.</span>color <span class="operator">=</span> <span class="string">&apos;red&apos;</span>
                x <span class="operator">=</span> grandfather
            <span class="keyword">else</span><span class="punctuation">:</span>
                <span class="keyword">if</span> x <span class="operator">==</span> x<span class="punctuation">.</span>parent<span class="punctuation">.</span>right<span class="punctuation">:</span>
                    x <span class="operator">=</span> x<span class="punctuation">.</span>parent
                    <span class="function">left_rotate</span><span class="punctuation">(</span>x<span class="punctuation">)</span>
                x<span class="punctuation">.</span>parent<span class="punctuation">.</span>color <span class="operator">=</span> <span class="string">&apos;black&apos;</span>
                grandfather<span class="punctuation">.</span>color <span class="operator">=</span> <span class="string">&apos;red&apos;</span>
                <span class="function">right_rotate</span><span class="punctuation">(</span>grandfather<span class="punctuation">)</span>

        <span class="comment"># родитель - правый ребенок деда</span>
        <span class="keyword">else</span><span class="punctuation">:</span>
            uncle <span class="operator">=</span> grandfather<span class="punctuation">.</span>left
            <span class="keyword">if</span> uncle<span class="punctuation">.</span>color <span class="keyword">is</span> <span class="string">&apos;red&apos;</span><span class="punctuation">:</span>
                x<span class="punctuation">.</span>parent<span class="punctuation">.</span>color <span class="operator">=</span> <span class="string">&apos;black&apos;</span>
                uncle<span class="punctuation">.</span>color <span class="operator">=</span> <span class="string">&apos;black&apos;</span>
                grandfather<span class="punctuation">.</span>color <span class="operator">=</span> <span class="string">&apos;red&apos;</span>
                x <span class="operator">=</span> grandfather
            <span class="keyword">else</span><span class="punctuation">:</span>
                <span class="keyword">if</span> x <span class="operator">==</span> x<span class="punctuation">.</span>parent<span class="punctuation">.</span>left<span class="punctuation">:</span>
                    x <span class="operator">=</span> x<span class="punctuation">.</span>parent
                    <span class="function">right_rotate</span><span class="punctuation">(</span>x<span class="punctuation">)</span>
                x<span class="punctuation">.</span>parent<span class="punctuation">.</span>color <span class="operator">=</span> <span class="string">&apos;black&apos;</span>
                grandfather<span class="punctuation">.</span>color <span class="operator">=</span> <span class="string">&apos;red&apos;</span>
                <span class="function">left_rotate</span><span class="punctuation">(</span>grandfather<span class="punctuation">)</span>

    root<span class="punctuation">.</span>color <span class="operator">=</span> <span class="string">&apos;black&apos;</span><!----></code><!----></div></div><!----> <div class="par svelte-q2zea3"><p class="svelte-cr0fdf"><!---->И теперь мы можем написать полный код вставки.
    При вставке мы спускаемся вниз, пока не дойдём до фиктивного листа.
    Далее заменяем этот фиктивный лист на новую вершину, добавляем её два фиктивных листа, красим её в красный
    и выполняем процедуру <span class="code svelte-1kfz46x"><code class="language-pseudocode svelte-127l4oe"><!----><span class="function">fix_insertion</span><span class="punctuation">(</span><span class="punctuation">)</span><!----></code><!----></span><!----> для восстановления свойств красно-чёрного дерева.<!----></p><!----></div><!----> <div class="codeblock svelte-in28rj"><div class="overflow-box svelte-in28rj"><code class="language-pseudocode svelte-127l4oe"><!----><span class="keyword">function</span> <span class="function">insert</span><span class="punctuation">(</span><span class="class-name">node</span><span class="operator">*</span> root<span class="punctuation">,</span> <span class="builtin">object</span> <span class="builtin">key</span><span class="punctuation">)</span>
    <span class="class-name">node</span> x <span class="operator">=</span> <span class="keyword">new</span> <span class="class-name">node</span><span class="punctuation">(</span><span class="builtin">key</span><span class="punctuation">,</span> color<span class="operator">=</span><span class="string">&apos;red&apos;</span><span class="punctuation">,</span> left<span class="operator">=</span><span class="boolean">none</span><span class="punctuation">,</span> right<span class="operator">=</span><span class="boolean">none</span><span class="punctuation">)</span>

    <span class="keyword">if</span> root <span class="keyword">is</span> <span class="boolean">none</span><span class="punctuation">:</span>  <span class="comment"># дерево пустое</span>
        root <span class="operator">=</span> x
        x<span class="punctuation">.</span>parent <span class="operator">=</span> <span class="boolean">none</span>

    <span class="keyword">else</span>
        Node p <span class="operator">=</span> root
        Node q <span class="operator">=</span> nil
        <span class="keyword">while</span> p <span class="keyword">is</span> <span class="keyword">not</span> <span class="boolean">none</span><span class="punctuation">:</span>  <span class="comment"># спускаемся вниз, пока не дойдем до подходящего листа</span>
            q <span class="operator">=</span> p
            <span class="keyword">if</span> p<span class="punctuation">.</span><span class="builtin">key</span> <span class="operator">&lt;</span> x<span class="punctuation">.</span><span class="builtin">key</span>
                p <span class="operator">=</span> p<span class="punctuation">.</span>right
            <span class="keyword">else</span>
                p <span class="operator">=</span> p<span class="punctuation">.</span>left

        x<span class="punctuation">.</span>parent <span class="operator">=</span> q

        <span class="comment"># добавляем новый узел x</span>
        <span class="keyword">if</span> q<span class="punctuation">.</span><span class="builtin">key</span> <span class="operator">&lt;</span> x<span class="punctuation">.</span><span class="builtin">key</span>
            q<span class="punctuation">.</span>right <span class="operator">=</span> x
        <span class="keyword">else</span>
            q<span class="punctuation">.</span>left <span class="operator">=</span> x

     <span class="function">fix_insertion</span><span class="punctuation">(</span>x<span class="punctuation">)</span><!----></code><!----></div></div><!----><!----><!----></article> <div class="svelte-1cvbhgs"></div><!----><!--]--><!----></main><!----><!--]--> <!--[!--><!--]--><!--]-->
			
			<script>
				{
					__sveltekit_48jyze = {
						base: new URL("../..", location).pathname.slice(0, -1)
					};

					const element = document.currentScript.parentElement;

					Promise.all([
						import("../../_app/immutable/entry/start.BJRRbOI6.js"),
						import("../../_app/immutable/entry/app.BVG58rn_.js")
					]).then(([kit, app]) => {
						kit.start(app, element, {
							node_ids: [0, 2, 97],
							data: [null,null,null],
							form: null,
							error: null
						});
					});
				}
			</script>
		</div>
</body>
</html>
