<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <link rel="icon" href="../../favicon.svg"/>
    <link rel="stylesheet" href="../../fonts/Inter/inter.css"/>
    <link rel="stylesheet" href="../../fonts/JetBrainsMono/jetbrainsmono.css"/>
    <link rel="stylesheet" href="../../variables.css"/>
    <link rel="stylesheet" href="../../global.css"/>
    <link rel="stylesheet" href="../../katex.css"/>

    <link rel="stylesheet" media="print" href="../../print.css">

    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    
		<link href="../../_app/immutable/assets/Link.Cb7NHG_N.css" rel="stylesheet">
		<link href="../../_app/immutable/assets/0._avqqY0J.css" rel="stylesheet">
		<link href="../../_app/immutable/assets/2.DXAScjb8.css" rel="stylesheet">
		<link href="../../_app/immutable/assets/Title.DPHn_YVg.css" rel="stylesheet">
		<link href="../../_app/immutable/assets/Par.K_845M5t.css" rel="stylesheet">
		<link href="../../_app/immutable/assets/P.B2DWHBcA.css" rel="stylesheet">
		<link href="../../_app/immutable/assets/Icon.D0g2C4hd.css" rel="stylesheet">
		<link href="../../_app/immutable/assets/Block.DihCq8ef.css" rel="stylesheet">
		<link href="../../_app/immutable/assets/Subheading.PZ7MELIW.css" rel="stylesheet">
		<link href="../../_app/immutable/assets/InternalCode.18_KRbfN.css" rel="stylesheet">
		<link href="../../_app/immutable/assets/Codeblock.CTVfIT4f.css" rel="stylesheet">
		<link href="../../_app/immutable/assets/Code.DJ30TqtG.css" rel="stylesheet">
		<link href="../../_app/immutable/assets/Math.BETNsMrj.css" rel="stylesheet">
		<link href="../../_app/immutable/assets/Heading.B4n5dO8q.css" rel="stylesheet">
		<link rel="modulepreload" href="../../_app/immutable/entry/start.BJRRbOI6.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/C4PYaXYV.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/D05M-i-Q.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/B1HoO4k0.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/DIeogL5L.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/D2mTW_Ts.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/zmIfRZ_X.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/DB1w4rN-.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/DDIRtGou.js">
		<link rel="modulepreload" href="../../_app/immutable/entry/app.BVG58rn_.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/CWj6FrbW.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/52QGYHnB.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/6jNYTp5s.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/C66zIgpa.js">
		<link rel="modulepreload" href="../../_app/immutable/nodes/0.BdmhUO9D.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/DGFEnqK6.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/BsetDOSZ.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/DQVJezX5.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/C_bKaSJV.js">
		<link rel="modulepreload" href="../../_app/immutable/nodes/2.7yTcSGO6.js">
		<link rel="modulepreload" href="../../_app/immutable/nodes/103.DC6bcCtr.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/69_IOA4Y.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/CcX1cm_-.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/ClksMsit.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/B8FEnsbH.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/C9QRwwNg.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/Cvd_SkJN.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/BRxLqHaC.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/D2QCM4hc.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/DunPP-_K.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/BPEYcd7-.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/BsuxlmZu.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/i9XClpbl.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/0Rd6UPhr.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/e5qaD0UW.js">
		<link rel="modulepreload" href="../../_app/immutable/chunks/CYtJBVty.js"><!--[--><!--]--><!--[--><!--]--><title>Строп</title>
</head>
<body data-sveltekit-preload-data="hover">
<div style="display: contents"><!--[--><!--[--><!----><header class="svelte-10uf3cq"><img src="/favicon.svg" alt="" role="presentation" class="svelte-10uf3cq"/> <nav class="svelte-10uf3cq"><a href="/scenario" class="svelte-1txvory colorless"><!---->Сценарий<!----></a><!----></nav></header><!----> <main><!--[--><!----><article class="svelte-1cvbhgs"><!----><div class="title svelte-uw1xhm"><!--[!--><h1 class="svelte-uw1xhm">Строп</h1><!--]--></div><!----> <div class="par svelte-q2zea3"><p class="svelte-cr0fdf"><!---->Представим текстовый редактор.
        Задача текстового редактора — хранить текст в памяти, отображать его,
        и, самое главное, позволять редактировать текст.<!----></p><!----> <p class="svelte-cr0fdf"><!---->Можно, конечно, использовать наивный подход к хранению текста в памяти просто в виде последовательности байт.
        При добавлении одного символа куда-то в начало нам придется сдвигать в памяти почти весь текст.
        А ведь сам текст может быть огромным, например какая-нибудь книга типа «Война и мир».<!----></p><!----> <p class="svelte-cr0fdf"><!---->Еще у нас есть операции удаления символов (наборов символов), замены символов и, иногда, поиска.
        В общем заключаем, что для эффективной работы с большими текстами наивного подхода недостаточно.<!----></p><!----><!----></div><!----> <div class="block svelte-8d3fzq definition"><h3 class="svelte-8d3fzq"><svg viewBox="0 0 48 48" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="svelte-1tf3wrl" style="height: 1.25rem; margin: 0rem;"><path d="M22.0542 26.0405L21.6581 26.1755L21.2285 26.2562L20.7731 26.2761L20.3006 26.2302L19.8206 26.1147L19.3434 25.9272L18.8797 25.6666L18.4405 25.3338L18.0368 24.9309L17.6793 24.4619L17.3785 23.9324L17.1439 23.3494L16.9842 22.7215L16.907 22.0586L16.9185 21.3718L17.0234 20.6731L17.2246 19.9755L17.5236 19.2924L17.9195 18.6375L18.4099 18.0246L18.9902 17.4671L19.654 16.9783L20.3929 16.5703L21.1969 16.2544L22.0542 16.0405L22.9516 15.9369L23.8746 15.9504L24.8078 16.0857L25.7348 16.3455L26.6389 16.7301L27.5032 17.2379L28.3108 17.8646L29.0452 18.6038L29.6909 19.4469L30.2333 20.3829L30.659 21.399L30.9566 22.4804L31.1163 23.6106L31.1305 24.7719L30.9941 25.9452L30.7043 27.1109L30.2611 28.2487L29.6669 29.3382L28.927 30.3593L28.0496 31.2924L27.0452 32.119L25.9269 32.8217L24.7102 33.3849L23.4128 33.795L22.0542 34.0405L20.6555 34.1125L19.239 34.0048L17.8281 33.7143L16.4466 33.2407L15.1183 32.5869L13.867 31.7589L12.7156 30.766L11.6858 29.6204L10.7981 28.3372L10.0709 26.9341L9.52021 25.4314L9.15969 23.8517L9.00001 22.2192L9.04872 20.5595L9.31004 18.8996L9.78474 17.2669L10.47 15.6889L11.3595 14.193L12.4432 12.8057L13.7076 11.5524L15.1362 10.4567L16.709 9.5401L18.4034 8.82166L20.1943 8.31748L22.0542 8.04046L23.9542 8L25.8641 8.20176L27.7528 8.64752L29.5888 9.33502L31.3412 10.258L32.9796 11.4061L34.4749 12.7652L35.7999 14.3172L36.9296 16.0406L37.8417 17.9108L38.5173 19.8999L38.9408 21.978L39.1005 24.1129L38.9888 26.2709L38.6026 28.4174L37.943 30.5171L37.0157 32.5353L35.831 34.4376L34.4034 36.1911L32.7519 37.7646L30.8992 39.1294L28.8719 40.2599L26.6997 41.1336L24.4155 41.7319L22.0542 42.0405" fill="none" stroke="currentColor" stroke-width="5.5" stroke-linecap="round" stroke-linejoin="round"></path><!----></svg><!----> <!--[!-->Строп<!--]--></h3> <p class="svelte-cr0fdf"><b>Строп</b> (rope) — структура данных для работы с большими строками, обеспечивающая эффективные
        операции конкатенации, вставки, удаления и индексации.<!----></p><!----> <p class="svelte-cr0fdf"><!---->Основная идея — представление строки в виде бинарного дерева,
        где листья содержат фрагменты строки, а внутренние узлы хранят метаданные для связи и балансировки.<!----></p><!----><!----></div><!----> <h1 class="svelte-1dact7k"><!---->Структура узлов<!----></h1><!----> <div class="par svelte-q2zea3"><p class="svelte-cr0fdf"><!---->Как я уже упомянул в основной идее, нам нужно два типа узлов: терминальный и внутренний.<!----></p><!----> <p class="svelte-cr0fdf"><!---->В терминальном узле будем хранить саму подстроку <span class="code svelte-1kfz46x"><code class="language-pseudocode svelte-127l4oe"><!----><span class="abstract-type">string</span> value<!----></code><!----></span><!---->.
        Во внутреннем узле мы храним дочерние узлы <span class="code svelte-1kfz46x"><code class="language-pseudocode svelte-127l4oe"><!---->left<!----></code><!----></span><!----> и <span class="code svelte-1kfz46x"><code class="language-pseudocode svelte-127l4oe"><!---->right<!----></code><!----></span><!---->.
        Для каждого узла будем ещё хранить полную длину левого поддерева, называемую весом.
        Эта информация нужна для реализации индексации.<!----></p><!----> <p class="svelte-cr0fdf"><!---->Ну и для оптимизации можно в каждом узле в поле <span class="code svelte-1kfz46x"><code class="language-pseudocode svelte-127l4oe"><!----><span class="builtin">int</span> <span class="builtin">length</span><!----></code><!----></span><!----> хранить
        полную длину дерева с корнем в этом узле.<!----></p><!----> <p class="svelte-cr0fdf"><!---->Можно реализовывать две структуры: одна для терминального узла, другая для внутреннего.
        А можно реализовать одну общую структуру.
        Критерием терминальности узла будет просто отсутствующее значение у <span class="code svelte-1kfz46x"><code class="language-pseudocode svelte-127l4oe"><!---->value<!----></code><!----></span><!---->.<!----></p><!----><!----></div><!----> <div class="codeblock svelte-in28rj"><div class="overflow-box svelte-in28rj"><code class="language-pseudocode svelte-127l4oe"><!----><span class="keyword">struct</span> <span class="class-name">node</span><span class="punctuation">:</span>
    <span class="class-name">node</span> left
    <span class="class-name">node</span> right

    <span class="abstract-type">string</span> value
    <span class="builtin">int</span> weight
    <span class="builtin">int</span> <span class="builtin">length</span><!----></code><!----></div></div><!----> <div class="par svelte-q2zea3"><p class="svelte-cr0fdf"><!---->У нас получается инвариант <!--[!--><span class="math"><!----><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>v.weight</mtext><mo>=</mo><mtext>v.left.length</mtext></mrow><annotation encoding="application/x-tex">\code{v.weight} = \code{v.left.length}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="enclosing code"><span class="mord text"><span class="mord">v.weight</span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="enclosing code"><span class="mord text"><span class="mord">v.left.length</span></span></span></span></span></span><!----></span><!--]--><!----> и <!--[!--><span class="math"><!----><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>v.length</mtext><mo>=</mo><mtext>v.left.length</mtext><mo>+</mo><mtext>v.right.length</mtext></mrow><annotation encoding="application/x-tex">\code{v.length} = \code{v.left.length} + \code{v.right.length}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="enclosing code"><span class="mord text"><span class="mord">v.length</span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="enclosing code"><span class="mord text"><span class="mord">v.left.length</span></span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="enclosing code"><span class="mord text"><span class="mord">v.right.length</span></span></span></span></span></span><!----></span><!--]--><!---->.
        При этом для терминальной вершины <span class="code svelte-1kfz46x"><code class="language-pseudocode svelte-127l4oe"><!---->t<!----></code><!----></span><!----> имеем <!--[!--><span class="math"><!----><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>t.weight</mtext><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\code{t.weight} = 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="enclosing code"><span class="mord text"><span class="mord">t.weight</span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span><!----></span><!--]--><!---->,
        что логично, ведь у терминальной вершины нет поддеревьев.<!----></p><!----></div><!----> <h1 class="svelte-1dact7k"><!---->Индексация<!----></h1><!----> <div class="par svelte-q2zea3"><p class="svelte-cr0fdf"><!---->Базовая операция, индексация, — получение символа по его индексу.<!----></p><!----></div><!----> <div class="codeblock svelte-in28rj"><div class="overflow-box svelte-in28rj"><code class="language-pseudocode svelte-127l4oe"><!----><span class="keyword">function</span> <span class="function">get_char</span><span class="punctuation">(</span><span class="class-name">node</span> rope<span class="punctuation">,</span> <span class="builtin">int</span> i<span class="punctuation">)</span> <span class="operator">-</span><span class="operator">&gt;</span> <span class="builtin">char</span><span class="punctuation">:</span>
    <span class="keyword">if</span> rope<span class="punctuation">.</span>value <span class="keyword">is</span> <span class="keyword">not</span> <span class="boolean">none</span><span class="punctuation">:</span>  <span class="comment"># если это терминальный узел</span>
        <span class="keyword">return</span> rope<span class="punctuation">.</span>value<span class="punctuation">[</span>i<span class="punctuation">]</span>

    <span class="keyword">if</span> i <span class="operator">&lt;</span> rope<span class="punctuation">.</span>weight<span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="function">get_char</span><span class="punctuation">(</span>rope<span class="punctuation">.</span>left<span class="punctuation">,</span> i<span class="punctuation">)</span>
    <span class="keyword">else</span><span class="punctuation">:</span>
        <span class="keyword">return</span> <span class="function">get_char</span><span class="punctuation">(</span>rope<span class="punctuation">.</span>right<span class="punctuation">,</span> i <span class="operator">-</span> rope<span class="punctuation">.</span>weight<span class="punctuation">)</span><!----></code><!----></div></div><!----> <h1 class="svelte-1dact7k"><!---->Вставка и удаление<!----></h1><!----> <h1 class="svelte-1dact7k"><!---->Конкатенация и разделение<!----></h1><!----> <div class="par svelte-q2zea3"><p class="svelte-cr0fdf"><!---->Для конкатенации двух стропов достаточно просто создать новый узел и прицепить к нему оба стропа.<!----></p><!----></div><!----> <div class="codeblock svelte-in28rj"><div class="overflow-box svelte-in28rj"><code class="language-pseudocode svelte-127l4oe"><!----><span class="keyword">function</span> <span class="function">concat</span><span class="punctuation">(</span><span class="class-name">node</span> s1<span class="punctuation">,</span> <span class="class-name">node</span> s2<span class="punctuation">)</span> <span class="operator">-</span><span class="operator">&gt;</span> <span class="class-name">node</span><span class="punctuation">:</span>
    rope <span class="operator">=</span> <span class="keyword">new</span> <span class="class-name">node</span><span class="punctuation">(</span><span class="punctuation">)</span>
    rope<span class="punctuation">.</span>left <span class="operator">=</span> s1
    rope<span class="punctuation">.</span>right <span class="operator">=</span> s2
    rope<span class="punctuation">.</span>weight <span class="operator">=</span> s1<span class="punctuation">.</span><span class="builtin">length</span>
    rope<span class="punctuation">.</span><span class="builtin">length</span> <span class="operator">=</span> s1<span class="punctuation">.</span><span class="builtin">length</span> <span class="operator">+</span> s2<span class="punctuation">.</span><span class="builtin">length</span>

    <span class="keyword">return</span> rope<!----></code><!----></div></div><!----> <div class="par svelte-q2zea3"><p class="svelte-cr0fdf"><!---->Временная сложность такой операции, очевидно, <!--[!--><span class="math"><!----><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span><!----></span><!--]--><!---->.<!----></p><!----></div><!----> <h1 class="svelte-1dact7k"><!---->Получение среза<!----></h1><!----><!----><!----></article> <div class="svelte-1cvbhgs"></div><!----><!--]--><!----></main><!----><!--]--> <!--[!--><!--]--><!--]-->
			
			<script>
				{
					__sveltekit_48jyze = {
						base: new URL("../..", location).pathname.slice(0, -1)
					};

					const element = document.currentScript.parentElement;

					Promise.all([
						import("../../_app/immutable/entry/start.BJRRbOI6.js"),
						import("../../_app/immutable/entry/app.BVG58rn_.js")
					]).then(([kit, app]) => {
						kit.start(app, element, {
							node_ids: [0, 2, 103],
							data: [null,null,null],
							form: null,
							error: null
						});
					});
				}
			</script>
		</div>
</body>
</html>
